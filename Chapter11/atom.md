# 11. 단위 테스트의 실제

<!-- TOC -->

* [11. 단위 테스트의 실제](#11-단위-테스트의-실제)
    * [11.1 기능뿐만 아니라 동작을 시험하라](#111-기능뿐만-아니라-동작을-시험하라)
        * [함수당 하나의 테스트 케이스만 있으면 적절하지 않을 때가 많다](#함수당-하나의-테스트-케이스만-있으면-적절하지-않을-때가-많다)
    * [11.2 테스트만을 위해 퍼블릭으로 만들지 말라](#112-테스트만을-위해-퍼블릭으로-만들지-말라)
    * [11.3 한 번에 하나의 동작만 테스트하라](#113-한-번에-하나의-동작만-테스트하라)
    * [11.4 공유 설정을 적절하게 사용하라](#114-공유-설정을-적절하게-사용하라)
        * [상태 공유는 문제가 될 수 있다](#상태-공유는-문제가-될-수-있다)
        * [설정 공유는 문제가 될 수 있다](#설정-공유는-문제가-될-수-있다)
    * [11.5 적절한 어서션 확인자를 사용하라](#115-적절한-어서션-확인자를-사용하라)
    * [11.6 테스트 용이성을 위해 의존성 주입을 사용하라](#116-테스트-용이성을-위해-의존성-주입을-사용하라)

<!-- TOC -->

## 11.1 기능뿐만 아니라 동작을 시험하라

**(결론) 테스트 대상 코드가 수행하는 작업이 여러 가지가 있으며 이 각각의 작업에 대해 테스트 케이스를 따로 작성해야 한다. 단순히 눈에 보이는 대로 함수 이름을 테스트 목록에 넣기보다는 함수가 수행하는 모든
동작으로 목록을 채우는 것이 좋다.**

### 함수당 하나의 테스트 케이스만 있으면 적절하지 않을 때가 많다

- 각 동작을 테스트하는 데 집중하자.
- 함수와 동작 사이에 일대일로 연결이 안 되는 경우가 많다.
- 함수 자체를 테스트하는 데만 집중하면, 정작 실제로 신경 써야 할 중요한 동작을 검증하지 않는 테스트 케이스를 작성하기가 매우 쉽다.

**(결론) 모든 동작이 테스트되었는지 거듭 확인하고, 오류 시나리오 또한 잊지 말자.**

## 11.2 테스트만을 위해 퍼블릭으로 만들지 말라

**(문제 상황) 좋은 단위 테스트는 궁극적으로 중요한 행동을 테스트해야 한다. 이렇게 하면 테스트는 코드의 문제점을 정확하게 감지할 가능성을 극대화하며 구현 세부 사항에 독립적으로 된다. 프라이빗 함수를 테스트하면
이
두 가지 목적에 어긋날 때가 많다.**

**(해결 방안) 퍼블릭 API를 통해 테스트하라. 비교적 간단한 클래스의 경우 퍼블릭 API만을 사용하여 모든 동작을 테스트하기가 매우 쉽지만, 클래스가 더 복잡하거나 많은 논리를 포함하면 퍼블릭 API를 통해
모든 동작을 테스트하는 것이 까다로울
수 있다. 이 경우에는 코드의 추상화 계층이 너무 크다는 것을 의미하기 때문에 코드를 더 작은 단위로 분할하는 것이 유익하다.**

**(조언) 실용적으로 하자. 퍼블릭 API의 정의는 어느 정도 해석의 여지가 있고, 일부 중요한 행동은 퍼블릭 API의 범위를 벗어날 수 있다. 하지만, 어떤 행동이 중요하고 궁극적으로 신경 써야 하는 것이라면,
퍼블릭
API 여부와 상관없이 테스트되어야 한다.**

## 11.3 한 번에 하나의 동작만 테스트하라

- 여러 동작을 한꺼번에 테스트하면 테스트가 제대로 안될 수 있다.
- 하나의 테스트 케이스로 모든 행동을 테스트하면 테스트 코드는 이해하기 어려워진다.
- 한 번에 모든 동작을 테스트하는 것은 잘 설명된 실패에 해당되지 않는다.

**(결론) 각 동작은 자체 테스트 케이스에서 테스트하자. 한 번에 하나의 동작을 테스트하면 테스트가 통과되지 못한 경우 메시지는 무엇이 문제인지 잘 설명한다.**

## 11.4 공유 설정을 적절하게 사용하라

- 테스트 케이스는 의존성을 설정하거나 테스트 데이터 저장소에 값을 채우거나 다른 조율의 상태를 초기화하는 등 어느 정도의 설정이 필요할 때가 있다.
- 설정 코드 블록을 사용하면 설정을 서로 다른 테스트 케이스 간에 공유할 수 있음. 이것은 두 가지 중요한 방식으로 일어날 수 있음
    - `상태 공유(sharing state)` : 설정 코드가 BeforeAll 블록에 추가되면 모든 테스트 케이스 전에 한 번 실행된다. 즉, 설정된 모든 상태가 모든 테스트 케이스 간에 공유된다.
    - `설정 공유(sharing configuration)` : 설정 코드가 BeforeEach 블록에 추가되면 각 테스트 케이스가 실행되기 전에 실행된다. 즉, 테스트 케이스는 이 코드에 의한 모든 설정을
      공유한다.

### 상태 공유는 문제가 될 수 있다

- 일반적으로 테스트 케이스는 서로 격리되어야 하므로 한 테스트 케이스가 수행하는 모든 조치는 다른 테스트 케이스의 결과에 영향을 미치지 않아야 한다.
- 테스트 간에 상태를 공유하고 이 상태가 가변적이면 위 규칙을 실수로 위반하기 쉽다.

**(결론) 가능하다면 상태를 공유하지 않는 것이 최선이다. 하지만, 상태 공유가 꼭 필요하다면 한 테스트 케이스에 의해 변경된 상태가 다른 케이스에 영향을 미치지 않도록 조심해야 한다.**

### 설정 공유는 문제가 될 수 있다

- 설정 공유는 번거로운 코드의 반복을 피하지만, 다른 개발자가 새로운 동작을 검증하기 위해 추가 설정을 작성하면 기존에 있던 테스트 케이스들이 실패할 수도 있다.(공유 설정의 잘못된 변경 사례)
- 설정을 공유하면, 어떤 테스트 케이스가 어떤 특정 항목에 의존하는지 정확하게 추적하는 것이 매우 어려우며, 향후 변경 사항이 발생하면 테스트 케이스가 목적했던 동작을 더 이상 테스트하지 않게 될 수 있다.

**(결론) 중요한 설정은 테스트 케이스 내에서 정의하자. 테스트 케이스에 의미 있는 방식으로 영향을 미치는 설정이 모두 테스트 케이스 내에 있기 때문에 각 테스트 케이스에서 원인과 결과가 명확해질 수 있다.**

**(중요) 설정 공유가 적절한 경우도 있다. 주어진 상황에 알맞게 사용하자.**

## 11.5 적절한 어서션 확인자를 사용하라

**(결론) 테스트 케이스가 실패하면 어서션 확인자는 실패 이유를 설명하는 메시지를 생성한다. 따라서 가장 적절한 어서션 확인자를 선택하는 것이 중요하다.**

## 11.6 테스트 용이성을 위해 의존성 주입을 사용하라

**(결론) 의존성 주입을 사용하면 코드의 테스트 용이성이 크게 향상된다.**
