# 좋은 코드, 나쁜 코드 (6) 예측 가능한 코드를 작성하라

date: February 28, 2024
updatedAt: March 3, 2024 11:35 PM
tags: 📖 Review
status: Done
preview: 좋은 코드, 나쁜 코드 6장을 읽고 정리한 글입니다.

---

### 💭 매직값을 반환하지 말아야 한다

매직값의 일반적인 예는 -1이다. 어떤 메서드의 동작이 잘못된 경우에 -1을 반환하는 것을 볼 수 있다. 

해당 메서드를 호출하는 메서드는 잘못된 경우에 대처해야 한다. 이것은 예외 책임을 호출부에 전가하는 행위인데 매직값을 반환하는 것으로 예외가 발생할 수 있음을 표현하기에 충분하지 않다. 반환 타입이 int인 경우에 해당 메서드의 내부를 확인하지 않고 예외가 발생할 수 있다는 사실을 파악하기 어렵다. 

이를 해결하는 방법은 널, 옵셔널 또는 오류를 반환하는 것이다. 값이 없을 수 있는 경우 이것을 코드 계약을 통해 명백하게 표현하는 것이 좋다. 자바의 경우에 널 안정성을 지원하지 않기 때문에 옵셔널의 사용하는 것이 하나의 방법이다. 

이 방법에도 문제는 존재한다. 옵셔널로 널값이나 비어 있는 값이 발생한 이유를 설명하기 어렵다. 

### 💭 널 객체 패턴을 적절히 사용하라

널값이나 옵셔널을 대체할 방법으로 널 객체 패턴을 사용할 수 있다. 널 객체 패턴의 예시로 빈 문자열과 빈 리스트가 있고, 일반적으로 모든 멤버 메서드가 아무것도 하지 않는 기본 클래스를 구현한다. 이를 통해 얻는 장점은 다음과 같다. 

- 유효한 값이 반환되어 시스템 동작이 피해를 최소화한다는 것이다.
- 빈 컬렉션을 제공하는 방식으로 코드가 간결해 진다. 호출하는 메서드 내의 널 값이나 옵셔널을 처리하기 위한 코드를 제거할 수 있다.

하지만, 단점도 명확하다. 

- 비즈니스 로직에 따라 반드시 존재해야 하는 값에 대해 널 객체는 올바르지 않을 수 있다.
    
    Ex) 반드시 필요한 카드 ID 정보가 빈 문자열로 반환되는 경우
    
- 더 복잡한 널 객체는 예측을 벗어날 수 있다.
    
    Ex) 머그컵이 존재하지 않는 경우, 널 객체가 크기가 0인 머그컵을 생성
    
- 널 객체의 구현이 예상을 벗어나는 경우가 있다.
    
    널 객체 내부 메서드는 아무 동작을 하지 않기 때문에 예상과 다르게 동작할 수 있다. 
    
- 오류가 발생한 사실을 숨긴다는 이유로 경우에 따라 바람직하지 않을 수 있다.

### 💭 예상치 못한 부수 효과를 피하라

### 💭 입력 매개변수를 수정하는 것에 주의하라

입력 매개변수를 수정하면 버그가 발생할 수 있다. 어떤 인스턴스가 여러 메서드를 오가는 상황은 빈번하다. 한 메서드가 매개변수로 전달되는 인스턴스 내부를 변경하는 경우에 예상치 못한 결과를 초래할 수 있다. 



이를 해결하는 방법은 복사본을 전달하는 것이다. 


### 💭 오해를 일으키는 함수는 작성하지 말라

**중요한 매개변수가 누락된 경우에 예상하지 못한 방향으로 동작할 수 있다.** 


`displayLegalDisclaimer`에 `legalText`에 널값이 전달되면 메서드는 아무런 동작을 하지 않는다. 메서드를 왜 이렇게 작성했을까? 호출하는 쪽에서 널에 대한 처리를 전가하지 않기 위함이다. 하지만 오해의 소지가 있고 예상을 벗어나는 동작을 하게 된다. 

이를 해결하는 방법은 중요한 입력을 필수 항목으로 두는 것이다. 어떤 매개변수 없이 메서드가 동작할 수 없는 경우에 해당 매개변수를 필수로 두고 널을 허용하지 않는 방법이 있다. 


### 💭 미래를 대비한 열거형 처리

열거형에 대해 일부 개발자는 형 안전성을 제공하고 시스템에 유효하지 않은 입력을 방지할 수 있는 방법이라고 주장한다. 어떤 사람은 열거형이 코드 전반에 퍼져 간결한 추상화 계층을 막는다고 한다. 개발자마다 입장이 분분한데, 이에 대한 대비로 열거형을 사용하는 경우에 주의할 점을 알아보자. 

미래에 추가될 수 있는 열것값을 암묵적으로 처리하는 것은 문제가 될 수 있다. 다음 코드는 if-return을 통해 매개변수에 대한 반환값을 결정하고 있다. 


만약 새로운 열거값이 추가된다면 어떻게 될까? 


WORLD_WILL_END의 경우에도 true를 반환하는 대참사가 일어난다. 이를 해결하는 방법은 switch문을 사용하고 테스트를 작성하는 것이다. 



열거형에 새로운 값이 추가되면 테스트는 실패한다. 빠른 실패 덕분에 프로덕션 코드를 수정할 기회를 얻게 된다. 하지만, 이 방법이 완전한 것은 아니다. switch 문을 사용하는 경우에 기본 케이스를 주의해야 한다. 


이 경우에는 default 부분에서 예외를 던지는 것으로 해결할 수 있다. 

이 밖에도 다른 프로젝트의 열거형에 의존하는 상황이 발생할 수 있는데, 이건 상황에 맞게 판단하여 대처하는 것이 필요하다. 

### 💭 요약

- 다른 개발자가 작성하는 코드는 종종 우리가 작성하는 코드에 의존한다.
    - 다른 개발자가 우리 코드의 기능을 잘못 해석하거나 처리해야 하는 특수한 경우를 발견하지 못하면, 우리가 작성한 코드에 기반한 그 코드에서 버그가 발생할 가능성이 크다.
    - 코드를 호출하는 쪽에서 예상한 대로 동작하기 위한 좋은 방법 중 하나는 중요한 세부사항이 코드 계약의 명백한 부분에 포함되도록 하는 것이다.
- 우리가 사용하는 코드에 대해 허술하게 가정을 하면 예상을 벗어나는 또 다른 결과를 볼 수 있다.
    - 예를 들어 열거형에 추가되는 새 값을 예상하지 못한 경우다.
    - 의존해서 사용 중인 코드가 가정을 벗어날 경우, 코드 컴파일을 중지하거나 테스트가 실패하도록 하는 것이 중요하다.
    - 테스트만으로는 예측을 벗어나는 코드의 문제를 해결할 수 없다. 다른 개발자가 코드를 잘못 해석하면 테스트해야 할 시나리오도 잘못 이해할 수 있다.