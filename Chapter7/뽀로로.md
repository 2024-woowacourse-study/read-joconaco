# 7.코드를 오용하기 어렵게 만들라

---

## 7.1 불변 객체로 만드는 것을 고려하라
불변 객체란 객체가 생성된 후에 상태를 바꿀 수 없는 객체이다.

가변 객체의 문제점
- 가변 객체는 추론하기 어렵다.
- 가변 객체는 다중 스레드에서 문제가 발생할 수 있다.

불변 객체로 생성하기 위해 객체를 생성할 때만 값을 할당하라.

### 7.1.3 불변성에 대한 디자인 패턴을 사용하라
불변적인 클래스의 가변적 버전을 만들어야 하는 경우, 클래스를 보다 다용도로 구현해야 할 필요가 있다.

이를 위한 두 가지 유용한 디자인 패턴
- 빌더 패턴
- 쓰기 시 복사 패턴

## 7.2 객체를 깊은 수준까지 불변적으로 만드는 것을 고려하라
클래스가 실수로 가변적으로 될 수 있는 일반적인 경우는 `깊은 가변성` 때문이다.

### 7.2.2 해결책: 방어적으로 복사하라 
방어적으로 복사하면 불변적인 클래스를 만드는 데 꽤 효과적일 수 있다.

하지만 단점도 명확하다.
- 복사하는 데 비용이 많이 들 수 있다.
- 클래스 내부에서 발생하는 변경을 막아주지 못하는 경우가 많다.

### 7.2.3 해결책: 불변적 자료구조를 사용하라
Java: 구아바 라이브러리의 `ImmutableList` 클래스

## 7.3 지나치게 일반적인 데이터 유형을 피하라
일반적이고 바로 가져다 쓸 수 있는 데이터 유형을 사용하는 것이 때로는 빠르고 쉬운 방법처럼 보일 수 있다.
하지만 무언가 구체적인 것을 나타낼 필요가 있을 때, 적은 노력을 추가로 들여서 전용 유형을 정의하는 것이 더 나을 때가 많다.

코드가 훨씬 더 명확해지고 오용하기 어렵기 때문에 중장기적으로 보자면 시간이 절약된다. 

## 7.5 데이터에 대해 진실의 원천을 하나만 가져야 한다
데이터는 종종 두 가지 형태로 제공된다.
- 기본 데이터: 코드에 제공해야 할 데이터
- 파생 데이터: 주어진 기본 데이터에 기반해서 코드가 계산할 수 있는 데이터

기본 데이터를 유일한 진실의 원천으로 사용해야 한다.

## 7.6 논리에 대한 진실의 원천을 하나만 가져야 한다
`진실의 원천`은 코드에 제공된 데이터에만 적용되는 것이 아니라 코드에 포함된 논리에도 적용된다.

중요한 논리에 대해 진실의 원천이 하나만 존재하도록 하면 코드가 훨씬 더 견고해진다.
이렇게 하면 서로 다른 코드들이 일치하지 않아 발생할 수 있는 버그의 위험을 거의 완전하게 제거할 수 있다.

## 요약
- 코드가 오용되기 쉽게 작성되고 나면 어느 시점에선가는 오용될 가능성이 크고 이것은 버그로 이어질 수 있다.
- 코드가 오용되는 몇 가지 일반적인 사례는 다음과 같다.
  - 호출하는 쪽에서 잘못된 입력을 제공
  - 다른 코드에서 일어나는 부수 효과
  - 함수 호출 시점이 잘못되거나 올바른 순서로 호출되지 않는 경우
  - 원래의 코드에 연관된 코드를 수정할 때 원래의 코드가 내포한 가정과 어긋나게 수정하는 경우
- 오용이 어렵거나 불가능하도록 코드를 설계하고 구조화하는 것이 종종 가능하다. 이를 통해 버그 발생 가능성이 크게 줄어들고 중장기적으로 개발자의 시간을 많이 절약할 수 있다. 
