# Chapter9 코드를 재사용하고 일반화할 수 있도록 하라

다룰 내용
- 안전하게 재사용할 수 있는 코드 작성 방법
- 다양한 문제 해결위한 일반화된 코드 작성 방법

향후 코드 재사용이 가능하도록 의도적으로 코드 작성 및 구조화 하는 것 바람직. 장기적으로 이득

간결한 추상화 계층(2장) 및 코드 모듈화(8장)과 매우 깊은 관련

## 9.1 가정을 주의하라

코드 작성 시 가정
장점
1. 코드 더 단순해짐
2. 더 효율적.
단점
1. 코드가 더 취약해짐
2. 활용도 낮아짐 -> 재사용 힘듬

### 9.1.1 가정은 코드 재사용 시 버그를 초래할 수 있다

예시) 인터넷 기사 클래스. 모든 이미지 반환 메서드. 이 코드가 이미지 포함 섹션이 하나라고 가정함

이미지 포함 반견 시 반복문 종료하므로 조금 빨라지지만 사소함.  
하지만 이미지 섹션 2개 이상이라면 예상대로 동작 안함. 버그 가능

기사 클래스가 다른 용도 재사용 or 기사 이미지 배치 변경 시 가정이 틀려버림.

### 9.1.2 해결책: 불필요한 가정을 피하라

반복문 미리 중단하지 않고 다 돌아보며 가정을 하지않음

>섣부른 최적화  
이를 피하려는 것은 소프트웨어 공학 및 컴퓨터 과학 내에 잘 정립된 개념.  
코드 최적화 시 많은 시간 노력 필요 -> 종종 가독성, 유지관리, 견고함 떨어짐. 하지만 엄청 실행 되야 이점 생김.  
최적화 보다 클린 코드 집중이 좋다. 최적화 이득 크면 그 때 해도 무방

### 9.1.3 해결책: 가정이 필요하면 강제적으로 하라 

가정을 강제적으로 시행하는 두 방법
1. 가정이 '깨지지 않게' 만들라: 가정 깨지면 컴파일 오류 발생 가능하면 가정 항상 유지 가능
2. 오류 전달 기술을 사용하라: 오류 감지 및 빠르게 실패하도록 코드 작성

#### 문제의 소지가 있는, 강제되지 않은 가정

코드가 예상대로 안굴러가도 티안나게 진행함. 큰 문제 초래

#### 가정의 강제적 확인

오류 전달 기법을 사용하여 가정을 강제로 인지, 신속 실패 코드로 변경

>오류 전달 기법  
어서션은 호출 쪽에서 복구 원치 않는 경우 적합.

---

가정 손해볼 상황 많음. 필요하다면 오류 빠지지 않게 가정을 강제로 시행하라.

## 9.2 전역 상태를 주의하라

전역변수는 프로그램 내 모든 콘텍스트에 영향 미침. 코드를 매우 취약, 재사용, 안전 하지 않음

>전역성과 가시성을 혼동하지 말라  
전역변수가 클래스의 인스턴스나 함수의 자체 버전 대신 프로그램의 모든 컨텍스트 간에 공유됨

### 9.2.1 전역 상태를 갖는 코드는 재사용 하기에 안전하지 않을 수 있다

예시) 온라인 쇼핑 앱. 항목 탐색 -> 바구니 추가 -> 체크아웃  
장바구니가 많은 부분 접근할 수 있어야 하는 상태. 전역 처리 한다면  
1. 인스턴스와 연결되지 않음
2. 어디서나 장바구니 호출 및 액세스 가능

편해보이는데 왜 안될까?

#### 누군가 이 코드를 재사용하려고 하면 어떻게 되는가?

암묵적 가정이 들어감 -> 앱 실행 중 인스턴스당 하나의 장바구니만 필요.
가정 깨지는 예시
-> 장바구니 서버에 저장한다면 다수 사용자 처리 불가능  
-> 항목 저장 기능 추가 된다면 그 장바구니까지 처리해야함

요약
최상의 경우 거의 중복된 코드로 유지 관리 비용 늘어남  
최악의 경우 악성 버그 발생

### 9.2.2 해결책: 공유 상태에 의존성 주입하라

서로 다른 클래스 간 상태를 공유하는 좋은 방법

---

프로그램 서로 다른 부분 간 상태를 공유해야할 경우, 의존성 주입을 사용해 보다 통제된 방식으로 수행하는 것이 더 안전

## 9.3 기본 반환값을 적절하게 사용하라



### 9.3.1 낮은 층위의 코드의 기본 반환값은 재사용성을 해칠 수 있다



### 9.3.2 해결책: 상위 수준의 코드에서 기본값을 제공하라



## 9.4 함수의 매개변수를 주목하라



### 9.4.1 필요 이상으로 매개변수를 받는 함수는 재사용하기 어려울 수 있다



### 9.4.2 해결책: 함수는 필요한 것만 매개변수로 받도록하라



## 9.5 제네릭의 사용을 고려하라



### 9.5.1 특정 유형에 의존하면 일반화를 제한한다



### 9.5.2 해결책: 제네릭을 사용하라





