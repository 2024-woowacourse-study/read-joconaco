# 10. 단위 테스트의 원칙

<!-- TOC -->

* [10. 단위 테스트의 원칙](#10-단위-테스트의-원칙)
    * [10.1 단위 테스트 기초](#101-단위-테스트-기초)
    * [10.2 좋은 단위 테스트는 어떻게 작성할 수 있는가?](#102-좋은-단위-테스트는-어떻게-작성할-수-있는가)
    * [10.3 퍼블릭 API에 집중하되 중요한 동작은 무시하지 말라](#103-퍼블릭-api에-집중하되-중요한-동작은-무시하지-말라)
    * [10.4 테스트 더블](#104-테스트-더블)
        * [테스트 더블 종류](#테스트-더블-종류)
    * [10.5 테스트 철학으로부터 신중하게 선택하라](#105-테스트-철학으로부터-신중하게-선택하라)

<!-- TOC -->

## 10.1 단위 테스트 기초

단위 테스트와 관련하여 기억해야 할 몇 가지 중요한 개념과 용어를 소개한다.

- `테스트 중인 코드(code under test)` : 실제 코드라고도 하고 테스트의 대상이 되는 코드를 의미한다.
- `테스트 코드(test code)` : 단위 테스트를 구성하는 코드를 가리킨다.
- `테스트 케이스(test case)` : 테스트 코드의 각 파일에는 일반적으로 여러 테스트 케이스가 있고, 각 테스트 케이스는 특정 동작이나 시나리오를 테스트한다. 가장 단순한 테스트 케이스가 아니라면 보통
  다음과 같이 세 개의 섹션으로 나뉘어져 있다.
    - 준비(arrange), 주어진(given)
    - 실행(act), 때(when)
    - 단언(assert), 그리고 나면(then)
- `테스트 러너(test runner)` : 실제로 테스트를 실행하는 도구이다. 테스트 코드 파일이 주어지면 각 테스트 케이스를 실행하고 통과 혹은 실패한 케이스에 대한 자세한 결과를 출력한다.

## 10.2 좋은 단위 테스트는 어떻게 작성할 수 있는가?

단위 테스트에서 문제가 발생하면 유지 관리가 매우 어렵고, 버그가 테스트 코드에서 발견되지 못하고 배포한 뒤에 발생할 수도 있다. 좋은 단위 테스트가 가져야 할 5가지 주요 기능을 정의해보자.

- `훼손의 정확한 감지` : 코드가 훼손되면 테스트가 실패한다. 또한 테스트는 코드가 실제로 훼손된 경우에만 실패해야 한다.
- `세부 구현 사항에 독립적` : 세부 구현 사항을 변경하더라도 테스트 코드는 변경하지 않는 것이 이상적이다.
- `잘 설명되는 실패` : 코드가 잘못되면 테스트는 실패의 원인과 문제점을 명확하게 설명해야 한다.
- `이해할 수 있는 테스트 코드` : 테스트 코드가 정확히 무엇을 테스트하기 위한 것이고 테스트가 어떻게 수행되는지 이해할 수 있어야 한다.
- `쉽고 빠르게 실행` :  단위 테스트가 느리거나 실행이 어려우면 개발 시간이 낭비된다.

## 10.3 퍼블릭 API에 집중하되 중요한 동작은 무시하지 말라

**(결론) 테스트는 가능하면 퍼블릭 API를 사용해 테스트하는 것을 목표로 해야 한다. 하지만, 설정을 수행하고 원하는 부수 효과를 확인하기 위해 테스트가 공용 API의 일부가 아닌 종속성과 상호작용해야 하는
경우가 많다.**

**(개인적으로 좋다고 느낀 내용) 퍼블릭 API만을 이용해 테스트하라, 실행 세부 사항을 테스트하지 말라는 둘 다 훌륭한 조언이지만, 테스트를 어떻게 할지 안내하는 원칙일 뿐, 퍼블릭 API와 구현 세부 사항의
정의는 주관적이고, 상황에 따라 다르다.**

## 10.4 테스트 더블

- 테스트 더블을 사용하는 이유는 일반적으로 세 가지 정도가 있다.
    - `테스트 단순화`
    - `테스트로부터 외부 세계 보호`
    - `외부로부터 테스트 보호`
- 테스트 더블을 사용하는 것이 낫겠다고 판단하면 어떤 테스트 더블을 사용할지 결정해야 한다.

### 테스트 더블 종류

`목(mock)` : 클래스나 인터페이스를 시뮬레이션하는 데 멤버 함수에 대한 호출을 기록하는 것 외에는 어떠한 일도 수행하지 않는다.

- 함수가 호출될 때 인수에 제공되는 값을 기록한다.
- 테스트 대상 코드가 의존성을 통해 제공되는 함수를 호출하는지 검증하기 위해 목을 사용할 수 있다.
- 목은 테스트 대상 코드에서 부수 효과를 일으키는 의존성을 시뮬레이션하는 데 가장 유용하다.

`스텁(stub)` : 함수가 호출되면 미리 정해 놓은 값을 반환함으로써 함수를 시뮬레이션한다.

- 테스트 대상 코드는 특정 멤버 함수를 호출하고 특정 값을 반환하도록 의존성을 시뮬레이션할 수 있다.
- 스텁은 테스트 대상 코드가 의존하는 코드로부터 어떤 값을 받아야 하는 경우 그 의존성을 시뮬레이션하는 데 유용하다.

**(중요) 목과 스텁은 문제가 될 수 있다. 목이나 스텁이 실제 의존성과 다른 방식으로 동작하도록 설정되면 테스트는 실제적이지 않다. 또한, 구현 세부 사항과 테스트가 밀접하게 결합하여 리팩터링이 어려워질 수
있다.**

`페이크(fake)` : 클래스(또는 인터페이스)의 대체 구현체로 테스트에서 안전하게 사용할 수 있다.

- 페이크는 실제 의존성의 공개 API를 정확하게 시뮬레이션하지만 구현은 일반적으로 단순한데, 외부 시스템과 통신하는 대신 페이크 내의 멤버 변수에 상태를 저장한다.
- 페이크의 요점은 코드 계약이 실제 의존성과 동일하기 때문에 실제 클래스(또는 인터페이스)가 특정 입력을 받아들이지 않는다면 페이크도 마찬가지라는 것이다.

**(결론) 페이크를 사용하면 실질적인 테스트가 이루어질 수 있고, 구현 세부 정보로부터 테스트를 분리할 수 있다.**

## 10.5 테스트 철학으로부터 신중하게 선택하라

- 테스트 철학과 방법론의 몇 가지 예는 다음과 같다.
    - `테스트 주도 개발(test-driven development)`
    - `행동 주도 개발(behavior-driven development)`
    - `수용 테스트 주도 개발(acceptance test-driven development)`
- 궁극적으로 달성하고자 하는 목표가 그 목표에 도달하기 위해 선택한 작업 방식보다 더 중요하다.
- 중요한 것은 우리가 좋은 품질의 테스트 코드를 철저하게 작성하고 고품질의 소프트웨어를 생산하는 것이다.
