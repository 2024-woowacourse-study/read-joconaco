# 3. 다른 개발자와 코드 계약

<!-- TOC -->

* [3. 다른 개발자와 코드 계약](#3-다른-개발자와-코드-계약)
    * [3.1 자신의 코드와 다른 개발자의 코드](#31-자신의-코드와-다른-개발자의-코드)
        * [코드베이스는 계속 변한다](#코드베이스는-계속-변한다)
        * [코드를 작성할 때, 세 가지를 고려하라](#코드를-작성할-때-세-가지를-고려하라)
    * [3.2 작성한 코드의 사용법을 다른 사람들은 어떻게 아는가?](#32-작성한-코드의-사용법을-다른-사람들은-어떻게-아는가)
    * [3.3 코드 계약](#33-코드-계약)
        * [계약에 의한 프로그래밍(Programming by contract)](#계약에-의한-프로그래밍programming-by-contract)
        * [계약의 세부 조항](#계약의-세부-조항)
        * [세부 조항에 너무 의존하지 말라](#세부-조항에-너무-의존하지-말라)
        * [세부 조항을 제거하는 방법](#세부-조항을-제거하는-방법)
    * [3.4 체크 및 어서션](#34-체크-및-어서션)

<!-- TOC -->

## 3.1 자신의 코드와 다른 개발자의 코드

### 코드베이스는 계속 변한다

- 다른 개발자들은 우리가 전혀 생각지 못한 완전히 다른 문제에서 우리가 작성한 하위 문제 해결 코드를 재사용할 수 있다.
- 요구 사항은 항상 변한다. 이는 코드와 소프트웨어도 항상 변한다는 것을 의미한다.

### 코드를 작성할 때, 세 가지를 고려하라

- 자신에게 분명하다고 해서 다른 사람에게도 분명한 것이 아니다. (코드를 이해하기 쉽고 코드 자체로 설명이 되게 하는 것이 좋다.)
- 다른 개발자는 무의식중에 우리의 코드를 망가뜨릴 수 있다.
- 시간이 지나면 자신의 코드를 기억하지 못한다.

**(결론) 코드베이스는 계속 변하고 일반적으로 여러 개발자에 의해 변경된다. 활발하게 코드를 변경하여도 코드의 품질이 유지되려면 코드가 튼튼하고 사용하기 쉬워야 한다.**

## 3.2 작성한 코드의 사용법을 다른 사람들은 어떻게 아는가?

**작성된 코드를 어떻게 사용해야 하는지 알아내기 위해 다른 개발자는 다음에 나열되는 일들을 할 수 있다.**

- `이름 확인` : 코드를 어떻게 사용해야 하는지에 대해 가장 잘 전달할 수 있는 방법 중 하나는 이름을 잘 짓는 것이다.
- `데이터 유형 확인` : 컴파일이 필요한 정적 유형의 언어에서는 데이터 유형을 인식하고 올바르게 사용해야 한다. 그렇지 않으면 컴파일도 못한다.
- `문서 읽기` : 어느정도까지만 신뢰 가능하다. 읽는다는 보장이 없고, 잘못 해석할 가능성이 있으며, 문서 업데이트가 제대로 이루어지지 않을 수 있다.
- `직접 물어보기` : 마찬가지로 신뢰하기 어렵다. 코드 작성자가 휴가를 간다면? 코드 작성자가 자신의 코드를 모른다면? 코드 작성자가 퇴사하면..?
- `코드를 살펴보기` : 실용적이지 않다. 모든 개발자들이 적당한 크기의 기능을 구현하려 해도 수십만 줄의 코드를 읽어야 할 수도 있다.

## 3.3 코드 계약

### 계약에 의한 프로그래밍(Programming by contract)

- 다른 사람들이 어떻게 코드를 사용할지, 또한 코드가 무엇을 할 것으로 기대할 수 있는지에 대한 것이다.
- 서로 다른 코드 간의 상호작용을 마치 `계약`처럼 생각한다.
- 모든 것이 계약에서 정의되기 때문에 분명하지 않은 것이 없으며, 예상과 다르게 실행되는 것도 없다.
- 코드의 계약에 대한 용어를 다음과 같은 세 가지 범주로 나누면 용이하다.
    - `선결 조건` : 콜 이전에 사실이어야 하는 것
    - `사후 조건` : 콜 이후에 사실이어야 하는 것
    - `불변 사항` : 콜 전후에 시스템 상태를 비교해 항상 변경되지 않아야 하는 사항

**(결론) 코드를 작성할 때, 만들어지는 계약의 내용이 무엇일지 그리고 어떻게 하면 코드를 사용하는 사람이 계약을 파악하고 따라갈 수 있을지에 대해 생각하는 것이 중요하다.**

### 계약의 세부 조항

- 코드에서 계약을 정의할 때, 명확한 부분과 세부 조항이 존재한다.
- ex) `명확한 부분` : 함수와 클래스 이름, 인자 유형, 반환 유형, 검사 예외
- ex) `세부 조항` : 주선문과 문서, 비검사 예외

**(결론) 코드 계약에서 조건을 명백하게 하는 것이 세부 조항을 사용하는 것보다 훨씬 낫다. 또한, 세부 조항이 항상 정확하지도 않다.**

### 세부 조항에 너무 의존하지 말라

```
class Crew {
    
    public Crew() { ... }

    // 크루는 온보딩을 하기 전까지 다른 미션을 진행할 수 없다. <- 이러한 문서는 세부 조항이다.
    boolean onboarding(Mission mission) { ... }

    ...    
}
```

- 다른 개발자들이 해당 코드를 사용할 때 모든 세부 조항을 다 알지 못할 가능성이 크다. 따라서 코드 계약을 전달할 때 세부 조항을 사용하는 것은 신뢰할 만한 방법이 아니다.
- 세부 조항에 너무 많이 의존하면 오용하기 쉬운 취약한 코드가 될 가능성이 크고, 예상과 다르게 동작하기 쉽다.
- 세부 조항에 의존하는 것을 피할 수 없는 경우도 있다. 이럴땐 너무 많이 의존하지 않도록 하는 것이 최선이다.

### 세부 조항을 제거하는 방법

- 다른 개발자가 코드를 올바르게 시용하기 위해 세부 조항에 의존하기보다 `잘못된 일을 하는 것을 처음부터 불가능하게 만드는 것`이 좋다.
- 코드 계약의 세부 조항에 있는 어떤 항목에 대해 발생 자체가 불가능하도록 `명백한 항목`으로 바꾸는 것이 가능한 경우가 있다.
- 코드가 오용되거나 잘못 설정되면 컴파일조차 되지 않도록 하는 것을 목표로 한다.
- 코드를 오용하는 것이 불가능하면 다른 개발자들이 그 코드를 사용할 때 버그가 침투할 가능성이 훨씬 낮아진다.

## 3.4 체크 및 어서션

**(결론) 일반적으로 컴파일러를 사용해 계약을 확인하는 것이 가장 신뢰할 수 있는 방법이다. 이것이 불가능하면 체크나 어서션을 사용해 실행 시간에 계약을 확인 가능하다.**