# Ch4. 오류

## 4.1 복구 가능성
- **복구 가능한 오류**
  - 시스템 외부의 무언가에 의해 야기되는 오류
    - 사용자의 잘못된 입력
    - 네트워크 오류
    - 중요하지 않은 작업 오류
  - 시스템 전체가 표나지 않고 적절하게 처리하기 위해 노력해야 함
- **복구할 수 없는 오류**
  - 프로그래밍 오류 때문에 발생
  - 피해를 최소화하고 개발자가 문제를 발견하고 해결할 가능성을 최대화해야 함

## 4.2 견고성 vs 실패
- **견고성**
  - 오류를 처리하고 계속 진행
- **실패**
  - 더 높은 코드 계층이 오류를 처리하게 하거나, 전체 프로그램의 작동을 멈춤

### 신속하게 실패하라
- 가능한 한 문제의 실제 발생 지점으로부터 가까운 곳에서 오류를 나타내는 것
- 복구할 수 있는 문제의 경우, 호출하는 쪽에서 오류를 복구할 기회를 최대한으로 제공하는 것
- 복구할 수 없는 문제의 경우, 개발자가 문제를 신속하게 파악하고 해결할 수 있는 기회를 최대한으로 제공하는 것
- 신속하게 실패하지 않으면 오류가 실제 위치에서 멀리 떨어진 코드에서 나타날 수 있음
  - 추적하기 어려워짐

### 요란하게 실패하라
- 오류가 발생하는데도 불구하고 아무도 모르는 상황을 막고자 하는 것
- 예외를 발생해 프로그램이 중단되게 하는 것
- 오류 메시지를 기록하는 것

### 오류를 숨기지 않음
- 오류를 숨기는 것은 복구할 수 있는 오류와 복구할 수 없는 오류 모두에 문제를 일으킴
  - 호출하는 쪽에서 복구하고자 할 수 있는 문제를 숨기는 경우
    - 호출하는 쪽에서 복구할 수 있는 기회를 없애는 것
    - 오류를 처리하는 대신 오류 발생 가능성을 전혀 알지 못하게 함
  - 복구할 수 없는 문제를 숨기는 경우
    - 프로그래밍 오류가 감춰짐
    - 개발팀이 오류에 대해 알지 못하게 만들 수 있음

## 4.3 오류 전달 방법
- 오류가 발생하면 더 높은 계층으로 오류를 알려야 함
- 복구가 불가능한 경우, 더 높은 계층에서 실행을 중지하고 오류를 기록하거나 전체 프로그램의 실행을 종료
- 복구가 가능한 경우, 호출하는 쪽에 오류를 알려 정상적으로 처리할 수 있도록 해야 함
- **명시적 방법**
  - 호출한 쪽에서 오류가 발생할 수 있음을 인지할 수 밖에 없도록 하는 방법
    - 처리하든, 이전 호출자에게 전달하든, **적극적인 선택의 결과**
      - 코드 계약의 **명확한 부분**
  - **전달 기법**
    - 검사 예외
    - 널 반환 유형
    - 옵셔널 반환 유형
    - 리절트 반환 유형
    - 아웃컴 반환 유형
    - 스위프트 오류
- **암시적 방법**
  - 호출한 쪽에 오류를 알리지만, 호출하는 쪽에서 그 오류를 신경쓰지 않아도 됨
    - 오류 발생 가능성을 알기 위해 문서나 코드를 읽어야 함
      - 코드 계약의 **숨겨진 세부 조항**
  - **전달 기법**
    - 비검사 예외
    - 매직값 반환 (피할 것)
    - 프로미스 또는 퓨처
    - 어서션
    - 체크
    - 패닉

### 검사 예외
- 컴파일러는 검사 예외에 대해 호출하는 쪽에서 예외를 인지하도록 강제적으로 조치
- 호출하는 쪽에서는 예외 처리를 위한 코드를 작성하거나, 자신의 함수 시그니처에 해당 예외 발새을 선언(throws) 해야 함
  - 둘 다 안하면 컴파일되지 않음 
  - 함수 시그니처에 표기하는 경우, 다시 해당 함수를 호출하는 코드에게 예외 처리를 맡기는 것과 같음
- 자바에서는 `Exception` 클래스를 상속 받은 클래스가 검사 예외가 됨

### 비검사 예외
- 예외를 발생시킬 수 있다는 사실을 전혀 모를 수 있음
- 어떤 예외를 발생시키는지 문서화하는 것이 바람직, 그러나 코드 계약의 세부 조항이므로 신뢰할 수 없음
- 예외가 발생할 수 있다는 사실을 호출하는 쪽에서 인지하리라는 보장이 없으므로 오류를 암시적으로 알리는 방법임
- 자바에서는 `RuntimeException` 클래스를 상속 받은 클래스가 검사 예외가 됨

## 4.4 복구할 수 없는 오류의 전달
- 복구할 가능성이 없는 오류가 발생하면 신속하게 실패하고, 요란하게 실패하는 것이 최상의 방법
- 복구할 수 없는 경우, 암시적 방법을 사용해야 함
  - 암시적 방법을 사용하면 오류 시나리오를 확인하거나, 처리하기 위한 코드를 호출 체인의 상위에 있는 모든 호출자가 다 작성할 필요가 없음
    - 어차피 복구할 수 없는 오류는 상위 계층으로 전달하는 것 외에는 할 수 있는 방법이 없고, 이런 상황에서 검사 예외를 발생시키게 되면 호출 체인의 모든 메서드 시그니처에 `throws`를 표기해야 하기 때문에 불필요한 추가 작업이 필요함
